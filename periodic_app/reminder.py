from aiogram import Bot
from aiogram.exceptions import TelegramBadRequest, TelegramForbiddenError
from random import randint, choice
from utils.loader_token import Token
from functions.sqlite_work import BD
from main_logic_bot.vishlist import kb_vishlist as kb


def select_message(gift: tuple) -> str:
    """–§—É–Ω–∫—Ü–∏—è –ø–æ –≤—ã–±–æ—Ä—É —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–∞"""

    phrases = [
        f'–í –¥–∞—Ç—É <b>"{gift[5]}"</b> –≤–∞—à–∞ –≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞ –∑–∞–≥–∞–¥–∞–ª–∞ –∂–µ–ª–∞–Ω–∏–µ <b>"{gift[2]}"</b>. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ–± —ç—Ç–æ–º, —ç—Ç–æ –∫—Ä–∞–π–Ω–µ –≤–∞–∂–Ω–æ!',
        f'<b>"{gift[5]}"</b> ‚Äî –∏–º–µ–Ω–Ω–æ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –≤–∞—à–∞ –≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞ —Å–æ–∑–¥–∞–ª–∞ –∂–µ–ª–∞–Ω–∏–µ <b>"{gift[2]}"</b>. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø–æ–º–Ω–∏—Ç–µ –æ–± —ç—Ç–æ–º!',
        f'–ù–µ —É–ø—É—Å—Ç–∏—Ç–µ –∏–∑ –≤–∏–¥—É –∂–µ–ª–∞–Ω–∏–µ –≤–∞—à–µ–π –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω–∫–∏ <b>"{gift[2]}"</b>, –∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ –∑–∞–≥–∞–¥–∞–Ω–æ <b>"{gift[5]}"</b>!',
        f'–í–∞—à–µ–π –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω–∫–µ —Ç–∞–∫ –≤–∞–∂–Ω–∞ <b>"{gift[2]}"</b> ‚Äî —ç—Ç–æ –∂–µ–ª–∞–Ω–∏–µ –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ <b>"{gift[5]}"</b>. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ–º–Ω–∏—Ç–µ –æ–± —ç—Ç–æ–º!',
        f'–í–∞—à–∞ –≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞ <b>"{gift[5]}"</b> —Å–æ–∑–¥–∞–ª–∞ –∂–µ–ª–∞–Ω–∏–µ <b>"{gift[2]}"</b>. –ü–æ—Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –Ω–µ –∑–∞–±—ã—Ç—å –æ–± —ç—Ç–æ–º!',
        f'–ü–æ–º–Ω–∏—Ç–µ, —á—Ç–æ <b>"{gift[5]}"</b> –≤–∞—à–∞ –≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞ –∑–∞–≥–∞–¥–∞–ª–∞ –∂–µ–ª–∞–Ω–∏–µ <b>"{gift[2]}"</b>. –≠—Ç–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ!',
        f'<b>"{gift[5]}"</b> ‚Äî –≤–∞—à–∞ –≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞ –≤—ã—Ä–∞–∑–∏–ª–∞ –∂–µ–ª–∞–Ω–∏–µ <b>"{gift[2]}"</b>. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ–± —ç—Ç–æ–º!',
        f'–í –º–æ–º–µ–Ω—Ç <b>"{gift[5]}"</b> –≤–∞—à–∞ –≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞ —Å–æ–∑–¥–∞–ª–∞ –∂–µ–ª–∞–Ω–∏–µ <b>"{gift[2]}"</b>. –≠—Ç–æ –≤–∞–∂–Ω–æ!',
        f'–ù–µ–ø—Ä–∏—è—Ç–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è, –µ—Å–ª–∏ –≤—ã –∑–∞–±—É–¥–µ—Ç–µ –æ –∂–µ–ª–∞–Ω–∏–∏ <b>"{gift[2]}"</b>, —Å–æ–∑–¥–∞–Ω–Ω–æ–º –≤–∞—à–µ–π –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω–∫–æ–π <b>"{gift[5]}"</b>!',
        f'–ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –≤ –ø–∞–º—è—Ç–∏, —á—Ç–æ <b>"{gift[5]}"</b> –≤–∞—à–∞ –≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞ –∑–∞–≥–∞–¥–∞–ª–∞ –∂–µ–ª–∞–Ω–∏–µ <b>"{gift[2]}"</b>.',
        f'–ù–∞–ø–æ–º–∏–Ω–∞–µ–º –≤–∞–º –æ –∂–µ–ª–∞–Ω–∏–∏ –≤–∞—à–µ–π –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω–∫–∏ ‚Äî <b>"{gift[2]}"</b>, –∑–∞–≥–∞–¥–∞–Ω–Ω—ã–π <b>"{gift[5]}"</b>. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ–± —ç—Ç–æ–º!',
        f'–ù–µ –ø—Ä–æ–∑–µ–≤–∞–π—Ç–µ: <b>"{gift[5]}"</b> ‚Äî –≤–∞—à–∞ –≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞ —Å–æ–∑–¥–∞–ª–∞ –∂–µ–ª–∞–Ω–∏–µ <b>"{gift[2]}"</b>. –≠—Ç–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ!',
        f'–í–∞—à–µ –≤–Ω–∏–º–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è: <b>"{gift[5]}"</b> –≤–∞—à–∞ –≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞ –∑–∞–≥–∞–¥–∞–ª–∞ –∂–µ–ª–∞–Ω–∏–µ <b>"{gift[2]}"</b>.',
        f'–ò–º–µ–π—Ç–µ –≤ –≤–∏–¥—É, —á—Ç–æ –≤ –¥–∞—Ç—É <b>"{gift[5]}"</b> –≤–∞—à–∞ –≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞ —Å–æ–∑–¥–∞–ª–∞ –∂–µ–ª–∞–Ω–∏–µ <b>"{gift[2]}"</b>. –≠—Ç–æ –≤–∞–∂–Ω–æ!'
    ]

    text = f'''
{choice(phrases)}

<b><a href='{gift[4]}'>–°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä üîó</a></b>
'''
    return text


async def send_reminder(bot: Bot) -> None:
    """–§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∂–µ–ª–∞–Ω–∏—è—Ö"""

    list_users = [Token(key='HIS_ID').find(), Token(key='HER_ID').find()]
    for user_id in list_users:

        if user_id == list_users[0]:
            half_id = list_users[1]
        else:
            half_id = list_users[0]

        data = await BD(path='gift.sqlite3').get_gifts(user_id=user_id)

        if (randint(1, 5) == 1) and (len(data) != 0):
            gift = choice(data)

            text = select_message(gift=gift)

            try:
                await bot.send_message(
                    chat_id=half_id,
                    text=text,
                    reply_markup=kb.inline.create_select_vish(user_id=half_id)
                )
            except (TelegramBadRequest, TelegramForbiddenError):
                pass
